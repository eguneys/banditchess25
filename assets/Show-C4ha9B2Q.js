import{m as St,s as Un,b as C,f as Kt,C as Yn,o as Zn,e as te,t as A,g as zt,_ as Xn,h as qe,j as It,c as b,k as jt,l as Q,n as Qn,p as Ft,q as ie,i as w,r as $e,v as Jn,a as $t,w as eo,x as Pt,u as to,y as no,S as U,z as Je,A as oo,B as ro,D as io,E as so,F as lo,G as ao,H as co,I as Mt,J as uo,K as fo,L as xt,M as At,d as po,N as ho}from"./index-DPiRce7Q.js";import{M as pe}from"./MeetButton-DgzYFZ_-.js";import{L as qt}from"./Leaderboard-BQ44DY0s.js";const go=(e,t)=>{const n=new Map,o=e.ctx();for(const[r,i]of e.allDests(o))if(i.nonEmpty()){const l=Array.from(i,St);r===o.king&&Un(r)===4&&(i.has(0)?l.push("c1"):i.has(56)&&l.push("c8"),i.has(7)?l.push("g1"):i.has(63)&&l.push("g8")),n.set(St(r),l)}return n},mo=["white","black"],Te=["a","b","c","d","e","f","g","h"],Ee=["1","2","3","4","5","6","7","8"],vo=[...Ee].reverse(),it=Array.prototype.concat(...Te.map(e=>Ee.map(t=>e+t))),Y=e=>it[8*e[0]+e[1]],x=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Gt=it.map(x);function _o(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const bo=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},st=e=>e==="white"?"black":"white",Pe=(e,t)=>{const n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},et=(e,t)=>e.role===t.role&&e.color===t.color,Me=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],J=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},Vt=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},lt=(e,t)=>{e.style.visibility=t?"visible":"hidden"},ge=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ut=e=>e.button===2,ne=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function Yt(e,t,n){const o=x(e);return t||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}const he=(e,t)=>Math.abs(e-t),wo=e=>(t,n,o,r)=>he(t,o)<2&&(e==="white"?r===n+1||n<=1&&r===n+2&&t===o:r===n-1||n>=6&&r===n-2&&t===o),Zt=(e,t,n,o)=>{const r=he(e,n),i=he(t,o);return r===1&&i===2||r===2&&i===1},Xt=(e,t,n,o)=>he(e,n)===he(t,o),Qt=(e,t,n,o)=>e===n||t===o,Jt=(e,t,n,o)=>Xt(e,t,n,o)||Qt(e,t,n,o),yo=(e,t,n)=>(o,r,i,l)=>he(o,i)<2&&he(r,l)<2||n&&r===l&&r===(e==="white"?0:7)&&(o===4&&(i===2&&t.includes(0)||i===6&&t.includes(7))||t.includes(i));function ko(e,t){const n=t==="white"?"1":"8",o=[];for(const[r,i]of e)r[1]===n&&i.color===t&&i.role==="rook"&&o.push(x(r)[0]);return o}function en(e,t,n){const o=e.get(t);if(!o)return[];const r=x(t),i=o.role,l=i==="pawn"?wo(o.color):i==="knight"?Zt:i==="bishop"?Xt:i==="rook"?Qt:i==="queen"?Jt:yo(o.color,ko(e,o.color),n);return Gt.filter(s=>(r[0]!==s[0]||r[1]!==s[1])&&l(r[0],r[1],s[0],s[1])).map(Y)}function K(e,...t){e&&setTimeout(()=>e(...t),1)}function Co(e){e.orientation=st(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function So(e,t){for(const[n,o]of t)o?e.pieces.set(n,o):e.pieces.delete(n)}function $o(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,o]of e.pieces)o.role==="king"&&o.color===t&&(e.check=n)}function Po(e,t,n,o){le(e),e.premovable.current=[t,n],K(e.premovable.events.set,t,n,o)}function se(e){e.premovable.current&&(e.premovable.current=void 0,K(e.premovable.events.unset))}function Mo(e,t,n){se(e),e.predroppable.current={role:t,key:n},K(e.predroppable.events.set,t,n)}function le(e){const t=e.predroppable;t.current&&(t.current=void 0,K(t.events.unset))}function xo(e,t,n){if(!e.autoCastle)return!1;const o=e.pieces.get(t);if(!o||o.role!=="king")return!1;const r=x(t),i=x(n);if(r[1]!==0&&r[1]!==7||r[1]!==i[1])return!1;r[0]===4&&!e.pieces.has(n)&&(i[0]===6?n=Y([7,i[1]]):i[0]===2&&(n=Y([0,i[1]])));const l=e.pieces.get(n);return!l||l.color!==o.color||l.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),r[0]<i[0]?(e.pieces.set(Y([6,i[1]]),o),e.pieces.set(Y([5,i[1]]),l)):(e.pieces.set(Y([2,i[1]]),o),e.pieces.set(Y([3,i[1]]),l)),!0)}function tn(e,t,n){const o=e.pieces.get(t),r=e.pieces.get(n);if(t===n||!o)return!1;const i=r&&r.color!==o.color?r:void 0;return n===e.selected&&Z(e),K(e.events.move,t,n,i),xo(e,t,n)||(e.pieces.set(n,o),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,K(e.events.change),i||!0}function at(e,t,n,o){if(e.pieces.has(n))if(o)e.pieces.delete(n);else return!1;return K(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,K(e.events.change),e.movable.dests=void 0,e.turnColor=st(e.turnColor),!0}function nn(e,t,n){const o=tn(e,t,n);return o&&(e.movable.dests=void 0,e.turnColor=st(e.turnColor),e.animation.current=void 0),o}function on(e,t,n){if(ct(e,t,n)){const o=nn(e,t,n);if(o){const r=e.hold.stop();Z(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return o!==!0&&(i.captured=o),K(e.movable.events.after,t,n,i),!0}}else if(qo(e,t,n))return Po(e,t,n,{ctrlKey:e.stats.ctrlKey}),Z(e),!0;return Z(e),!1}function rn(e,t,n,o){const r=e.pieces.get(t);r&&(Ao(e,t,n)||o)?(e.pieces.delete(t),at(e,r,n,o),K(e.movable.events.afterNewPiece,r.role,n,{premove:!1,predrop:!1})):r&&Do(e,t,n)?Mo(e,r.role,n):(se(e),le(e)),e.pieces.delete(t),Z(e)}function tt(e,t,n){if(K(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Z(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&on(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(ln(e,t)||dt(e,t))&&(sn(e,t),e.hold.start())}function sn(e,t){e.selected=t,dt(e,t)?e.premovable.customDests||(e.premovable.dests=en(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function Z(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ln(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const ct=(e,t,n)=>{var o,r;return t!==n&&ln(e,t)&&(e.movable.free||!!(!((r=(o=e.movable.dests)===null||o===void 0?void 0:o.get(t))===null||r===void 0)&&r.includes(n)))};function Ao(e,t,n){const o=e.pieces.get(t);return!!o&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}function dt(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function qo(e,t,n){var o,r;const i=(r=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(t))!==null&&r!==void 0?r:en(e.pieces,t,e.premovable.castle);return t!==n&&dt(e,t)&&i.includes(n)}function Do(e,t,n){const o=e.pieces.get(t),r=e.pieces.get(n);return!!o&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&(o.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===o.color&&e.turnColor!==o.color}function To(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Eo(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],o=t[1];let r=!1;if(ct(e,n,o)){const i=nn(e,n,o);if(i){const l={premove:!0};i!==!0&&(l.captured=i),K(e.movable.events.after,n,o,l),r=!0}}return se(e),r}function No(e,t){const n=e.predroppable.current;let o=!1;if(!n)return!1;if(t(n)){const r={role:n.role,color:e.movable.color};at(e,r,n.key)&&(K(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0)}return le(e),o}function ut(e){se(e),le(e),Z(e)}function Dt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ut(e)}function me(e,t,n){let o=Math.floor(8*(e[0]-n.left)/n.width);t||(o=7-o);let r=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(r=7-r),o>=0&&o<8&&r>=0&&r<8?Y([o,r]):void 0}function Lo(e,t,n,o){const r=x(e),i=Gt.filter(a=>Jt(r[0],r[1],a[0],a[1])||Zt(r[0],r[1],a[0],a[1])),s=i.map(a=>Yt(Y(a),n,o)).map(a=>Pe(t,a)),[,d]=s.reduce((a,u,c)=>a[0]<u?a:[u,c],[s[0],0]);return Y(i[d])}const z=e=>e.orientation==="white",an="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Oo={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Bo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function cn(e){e==="start"&&(e=an);const t=new Map;let n=7,o=0;for(const r of e)switch(r){case" ":case"[":return t;case"/":if(--n,n<0)return t;o=0;break;case"~":{const i=t.get(Y([o-1,n]));i&&(i.promoted=!0);break}default:{const i=r.charCodeAt(0);if(i<57)o+=i-48;else{const l=r.toLowerCase();t.set(Y([o,n]),{role:Oo[l],color:r===l?"black":"white"}),++o}}}return t}function Ho(e){return vo.map(t=>Te.map(n=>{const o=e.get(n+t);if(o){let r=Bo[o.role];return o.color==="white"&&(r=r.toUpperCase()),o.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function dn(e,t){t.animation&&(ft(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function un(e,t){var n,o,r;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((o=t.drawable)===null||o===void 0)&&o.autoShapes&&(e.drawable.autoShapes=[]),ft(e,t),t.fen&&(e.pieces=cn(t.fen),e.drawable.shapes=((r=t.drawable)===null||r===void 0?void 0:r.shapes)||[]),"check"in t&&$o(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&sn(e,e.selected),dn(e,t),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",l="e"+i,s=e.movable.dests.get(l),d=e.pieces.get(l);if(!s||!d||d.role!=="king")return;e.movable.dests.set(l,s.filter(a=>!(a==="a"+i&&s.includes("c"+i))&&!(a==="h"+i&&s.includes("g"+i))))}}function ft(e,t){for(const n in t)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&Tt(e[n])&&Tt(t[n])?ft(e[n],t[n]):e[n]=t[n])}function Tt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const fe=(e,t)=>t.animation.enabled?Ko(e,t):re(e,t);function re(e,t){const n=e(t);return t.dom.redraw(),n}const Ye=(e,t)=>({key:e,pos:x(e),piece:t}),Ro=(e,t)=>t.sort((n,o)=>Pe(e.pos,n.pos)-Pe(e.pos,o.pos))[0];function Wo(e,t){const n=new Map,o=[],r=new Map,i=[],l=[],s=new Map;let d,a,u;for(const[c,h]of e)s.set(c,Ye(c,h));for(const c of it)d=t.pieces.get(c),a=s.get(c),d?a?et(d,a.piece)||(i.push(a),l.push(Ye(c,d))):l.push(Ye(c,d)):a&&i.push(a);for(const c of l)a=Ro(c,i.filter(h=>et(c.piece,h.piece))),a&&(u=[a.pos[0]-c.pos[0],a.pos[1]-c.pos[1]],n.set(c.key,u.concat(u)),o.push(a.key));for(const c of i)o.includes(c.key)||r.set(c.key,c.piece);return{anims:n,fadings:r}}function fn(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const o=1-(t-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const r=zo(o);for(const i of n.plan.anims.values())i[2]=i[0]*r,i[3]=i[1]*r;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>fn(e,i))}}function Ko(e,t){const n=new Map(t.pieces),o=e(t),r=Wo(n,t);if(r.anims.size||r.fadings.size){const i=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:r},i||fn(t,performance.now())}else t.dom.redraw();return o}const zo=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Io=["green","red","blue","yellow"];function jo(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Z(e):ut(e);const n=ge(t),o=me(n,z(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:n,brush:Uo(t),snapToValidMove:e.drawable.defaultSnapToValidMove},pn(e))}function pn(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=me(t.pos,z(e),e.dom.bounds());n||(t.snapToValidMove=!1);const o=t.snapToValidMove?Lo(t.orig,t.pos,z(e),e.dom.bounds()):n;o!==t.mouseSq&&(t.mouseSq=o,t.dest=o!==t.orig?o:void 0,e.dom.redrawNow()),pn(e)}})}function Fo(e,t){e.drawable.current&&(e.drawable.current.pos=ge(t))}function Go(e){const t=e.drawable.current;t&&(t.mouseSq&&Yo(e.drawable,t),hn(e))}function hn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Vo(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),gn(e.drawable))}function Uo(e){var t;const n=(e.shiftKey||e.ctrlKey)&&Ut(e),o=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Io[(n?1:0)+(o?2:0)]}function Yo(e,t){const n=r=>r.orig===t.orig&&r.dest===t.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter(r=>!n(r))),(!o||o.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),gn(e)}function gn(e){e.onChange&&e.onChange(e.shapes)}function Zo(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),o=ge(t),r=me(o,z(e),n);if(!r)return;const i=e.pieces.get(r),l=e.selected;if(!l&&e.drawable.enabled&&(e.drawable.eraseOnClick||!i||i.color!==e.turnColor)&&Vo(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||i||l||Xo(e,o)))t.preventDefault();else if(t.touches)return;const s=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&ct(e,e.selected,r)?fe(c=>tt(c,r),e):tt(e,r);const a=e.selected===r,u=vn(e,r);if(i&&u&&a&&To(e,r)){e.draggable.current={orig:r,piece:i,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:l,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const c=e.dom.elements.ghost;c&&(c.className=`ghost ${i.color} ${i.role}`,J(c,Me(n)(x(r),z(e))),lt(c,!0)),pt(e)}else s&&se(e),d&&le(e);e.dom.redraw()}function Xo(e,t){const n=z(e),o=e.dom.bounds(),r=Math.pow(o.width/8,2);for(const i of e.pieces.keys()){const l=Yt(i,n,o);if(Pe(l,t)<=r)return!0}return!1}function Qo(e,t,n,o){const r="a0";e.pieces.set(r,t),e.dom.redraw();const i=ge(n);e.draggable.current={orig:r,piece:t,origPos:i,pos:i,started:!0,element:()=>vn(e,r),originTarget:n.target,newPiece:!0,force:!!o,keyHasChanged:!1},pt(e)}function pt(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(!o||!et(o,n.piece))Ne(e);else if(!n.started&&Pe(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const i=n.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),n.element=i}const r=e.dom.bounds();J(n.element,[n.pos[0]-r.left-r.width/16,n.pos[1]-r.top-r.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==me(n.pos,z(e),r))}pt(e)})}function Jo(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=ge(t))}function er(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}se(e),le(e);const o=ge(t)||n.pos,r=me(o,z(e),e.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?rn(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,on(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),K(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===r||!r)?Z(e):e.selectable.enabled||Z(e),mn(e),e.draggable.current=void 0,e.dom.redraw()}function Ne(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Z(e),mn(e),e.dom.redraw())}function mn(e){const t=e.dom.elements;t.ghost&&lt(t.ghost,!1)}function vn(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function tr(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Et(e,2),setTimeout(()=>Et(e,void 0),120)},120)}function Et(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function nr(e,t){function n(){Co(e),t()}return{set(o){o.orientation&&o.orientation!==e.orientation&&n(),dn(e,o),(o.fen?fe:re)(r=>un(r,o),e)},state:e,getFen:()=>Ho(e.pieces),toggleOrientation:n,setPieces(o){fe(r=>So(r,o),e)},selectSquare(o,r){o?fe(i=>tt(i,o,r),e):e.selected&&(Z(e),e.dom.redraw())},move(o,r){fe(i=>tn(i,o,r),e)},newPiece(o,r){fe(i=>at(i,o,r),e)},playPremove(){if(e.premovable.current){if(fe(Eo,e))return!0;e.dom.redraw()}return!1},playPredrop(o){if(e.predroppable.current){const r=No(e,o);return e.dom.redraw(),r}return!1},cancelPremove(){re(se,e)},cancelPredrop(){re(le,e)},cancelMove(){re(o=>{ut(o),Ne(o)},e)},stop(){re(o=>{Dt(o),Ne(o)},e)},explode(o){tr(e,o)},setAutoShapes(o){re(r=>r.drawable.autoShapes=o,e)},setShapes(o){re(r=>r.drawable.shapes=o,e)},getKeyAtDomPos(o){return me(o,z(e),e.dom.bounds())},redrawAll:t,dragNewPiece(o,r,i){Qo(e,o,r,i)},destroy(){Dt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function or(){return{pieces:cn(an),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:bo()}}const Nt={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function rr(){const e=T("defs"),t=B(T("filter"),{id:"cg-filter-blur"});return t.appendChild(B(T("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function ir(e,t,n){var o;const r=e.drawable,i=r.current,l=i&&i.mouseSq?i:void 0,s=new Map,d=e.dom.bounds(),a=r.autoShapes.filter(p=>!p.piece);for(const p of r.shapes.concat(a).concat(l?[l]:[])){if(!p.dest)continue;const _=(o=s.get(p.dest))!==null&&o!==void 0?o:new Set,v=Be(Oe(x(p.orig),e.orientation),d),f=Be(Oe(x(p.dest),e.orientation),d);_.add(ot(v,f)),s.set(p.dest,_)}const u=r.shapes.concat(a).map(p=>({shape:p,current:!1,hash:Lt(p,nt(p.dest,s),!1,d)}));l&&u.push({shape:l,current:!0,hash:Lt(l,nt(l.dest,s),!0,d)});const c=u.map(p=>p.hash).join(";");if(c===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=c;const h=t.querySelector("defs");sr(r,u,h),lr(u,t.querySelector("g"),n.querySelector("g"),p=>dr(e,p,r.brushes,s,d))}function sr(e,t,n){var o;const r=new Map;let i;for(const d of t.filter(a=>a.shape.dest&&a.shape.brush))i=_n(e.brushes[d.shape.brush],d.shape.modifiers),!((o=d.shape.modifiers)===null||o===void 0)&&o.hilite&&r.set(Le(i).key,Le(i)),r.set(i.key,i);const l=new Set;let s=n.firstElementChild;for(;s;)l.add(s.getAttribute("cgKey")),s=s.nextElementSibling;for(const[d,a]of r.entries())l.has(d)||n.appendChild(pr(a))}function lr(e,t,n,o){const r=new Map;for(const i of e)r.set(i.hash,!1);for(const i of[t,n]){const l=[];let s=i.firstElementChild,d;for(;s;)d=s.getAttribute("cgHash"),r.has(d)?r.set(d,!0):l.push(s),s=s.nextElementSibling;for(const a of l)i.removeChild(a)}for(const i of e.filter(l=>!r.get(l.hash)))for(const l of o(i))l.isCustom?n.appendChild(l.el):t.appendChild(l.el)}function Lt({orig:e,dest:t,brush:n,piece:o,modifiers:r,customSvg:i,label:l},s,d,a){var u,c;return[a.width,a.height,d,e,t,n,s&&"-",o&&ar(o),r&&cr(r),i&&`custom-${Ot(i.html)},${(c=(u=i.center)===null||u===void 0?void 0:u[0])!==null&&c!==void 0?c:"o"}`,l&&`label-${Ot(l.text)}`].filter(h=>h).join(",")}function ar(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function cr(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function Ot(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function dr(e,{shape:t,current:n,hash:o},r,i,l){var s,d;const a=Be(Oe(x(t.orig),e.orientation),l),u=t.dest?Be(Oe(x(t.dest),e.orientation),l):a,c=t.brush&&_n(r[t.brush],t.modifiers),h=i.get(t.dest),p=[];if(c){const _=B(T("g"),{cgHash:o});p.push({el:_}),a[0]!==u[0]||a[1]!==u[1]?_.appendChild(fr(t,c,a,u,n,nt(t.dest,i))):_.appendChild(ur(r[t.brush],a,n,l))}if(t.label){const _=t.label;(s=_.fill)!==null&&s!==void 0||(_.fill=t.brush&&r[t.brush].color);const v=t.brush?void 0:"tr";p.push({el:hr(_,o,a,u,h,v),isCustom:!0})}if(t.customSvg){const _=(d=t.customSvg.center)!==null&&d!==void 0?d:"orig",[v,f]=_==="label"?wn(a,u,h).map(P=>P-.5):_==="dest"?u:a,m=B(T("g"),{transform:`translate(${v},${f})`,cgHash:o});m.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,p.push({el:m,isCustom:!0})}return p}function ur(e,t,n,o){const r=gr(),i=(o.width+o.height)/(4*Math.max(o.width,o.height));return B(T("circle"),{stroke:e.color,"stroke-width":r[n?0:1],fill:"none",opacity:bn(e,n),cx:t[0],cy:t[1],r:i-r[1]/2})}function Le(e){return["#ffffff","#fff","white"].includes(e.color)?Nt.hilitePrimary:Nt.hiliteWhite}function fr(e,t,n,o,r,i){var l;function s(u){var c;const h=vr(i&&!r),p=o[0]-n[0],_=o[1]-n[1],v=Math.atan2(_,p),f=Math.cos(v)*h,m=Math.sin(v)*h;return B(T("line"),{stroke:u?Le(t).color:t.color,"stroke-width":mr(t,r)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?Le(t).key:t.key})`,opacity:!((c=e.modifiers)===null||c===void 0)&&c.hilite?1:bn(t,r),x1:n[0],y1:n[1],x2:o[0]-f,y2:o[1]-m})}if(!(!((l=e.modifiers)===null||l===void 0)&&l.hilite))return s(!1);const d=T("g"),a=B(T("g"),{filter:"url(#cg-filter-blur)"});return a.appendChild(_r(n,o)),a.appendChild(s(!0)),d.appendChild(a),d.appendChild(s(!1)),d}function pr(e){const t=B(T("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(B(T("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function hr(e,t,n,o,r,i){var l;const d=.4*.75**e.text.length,a=wn(n,o,r),u=i==="tr"?.4:0,c=B(T("g"),{transform:`translate(${a[0]+u},${a[1]-u})`,cgHash:t});c.appendChild(B(T("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:(l=e.fill)!==null&&l!==void 0?l:"#666",stroke:"white"}));const h=B(T("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return h.innerHTML=e.text,c.appendChild(h),c}function Oe(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function nt(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function B(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function _n(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function gr(){return[3/64,4/64]}function mr(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function bn(e,t){return(e.opacity||1)*(t?.9:1)}function vr(e){return(e?20:10)/64}function Be(e,t){const n=Math.min(1,t.width/t.height),o=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*o]}function _r(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return B(T("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function ot(e,t,n=!0){const o=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(o*8/Math.PI)+16)%16:o}function br(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,o)=>n+o*o,0))}function wn(e,t,n){let o=br(e,t);const r=ot(e,t,!1);if(n&&(o-=33/64,n.size>1)){o-=10/64;const i=ot(e,t);(n.has((i+1)%16)||n.has((i+15)%16))&&i&1&&(o-=.4)}return[e[0]-Math.cos(r)*o,e[1]-Math.sin(r)*o].map(i=>i+.5)}function wr(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const d of mo)e.classList.toggle("orientation-"+d,t.orientation===d);e.classList.toggle("manipulable",!t.viewOnly);const n=ne("cg-container");e.appendChild(n);const o=ne("cg-board");n.appendChild(o);let r,i,l;if(t.drawable.visible&&(r=B(T("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(rr()),r.appendChild(T("g")),i=B(T("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(T("g")),l=ne("cg-auto-pieces"),n.appendChild(r),n.appendChild(i),n.appendChild(l)),t.coordinates){const d=t.orientation==="black"?" black":"",a=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const u=t.orientation==="white"?c=>c+1:c=>8-c;Te.forEach((c,h)=>n.appendChild(Ze(Ee.map(p=>c+p),"squares rank"+u(h)+d+a)))}else n.appendChild(Ze(Ee,"ranks"+d+a)),n.appendChild(Ze(Te,"files"+d))}let s;return t.draggable.enabled&&t.draggable.showGhost&&(s=ne("piece","ghost"),lt(s,!1),n.appendChild(s)),{board:o,container:n,wrap:e,ghost:s,svg:r,customSvg:i,autoPieces:l}}function Ze(e,t){const n=ne("coords",t);let o;for(const r of e)o=ne("coord"),o.textContent=r,n.appendChild(o);return n}function yr(e,t){if(!e.dropmode.active)return;se(e),le(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=ge(t),r=o&&me(o,z(e),e.dom.bounds());r&&rn(e,"a0",r)}e.dom.redraw()}function kr(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",r=>r.preventDefault()),e.viewOnly)return;const o=Sr(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1})}function Cr(e,t){const n=[];if("ResizeObserver"in window||n.push(ke(document.body,"chessground.resize",t)),!e.viewOnly){const o=Bt(e,Jo,Fo),r=Bt(e,er,Go);for(const l of["touchmove","mousemove"])n.push(ke(document,l,o));for(const l of["touchend","mouseup"])n.push(ke(document,l,r));const i=()=>e.dom.bounds.clear();n.push(ke(document,"scroll",i,{capture:!0,passive:!0})),n.push(ke(window,"resize",i,{passive:!0}))}return()=>n.forEach(o=>o())}function ke(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}const Sr=e=>t=>{e.draggable.current?Ne(e):e.drawable.current?hn(e):t.shiftKey||Ut(t)?e.drawable.enabled&&jo(e,t):e.viewOnly||(e.dropmode.active?yr(e,t):Zo(e,t))},Bt=(e,t,n)=>o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||t(e,o)};function $r(e){const t=z(e),n=Me(e.dom.bounds()),o=e.dom.elements.board,r=e.pieces,i=e.animation.current,l=i?i.plan.anims:new Map,s=i?i.plan.fadings:new Map,d=e.draggable.current,a=Mr(e),u=new Set,c=new Set,h=new Map,p=new Map;let _,v,f,m,P,$,O,y,G,q;for(v=o.firstChild;v;){if(_=v.cgKey,yn(v))if(f=r.get(_),P=l.get(_),$=s.get(_),m=v.cgPiece,v.cgDragging&&(!d||d.orig!==_)&&(v.classList.remove("dragging"),J(v,n(x(_),t)),v.cgDragging=!1),!$&&v.cgFading&&(v.cgFading=!1,v.classList.remove("fading")),f){if(P&&v.cgAnimating&&m===Ce(f)){const k=x(_);k[0]+=P[2],k[1]+=P[3],v.classList.add("anim"),J(v,n(k,t))}else v.cgAnimating&&(v.cgAnimating=!1,v.classList.remove("anim"),J(v,n(x(_),t)),e.addPieceZIndex&&(v.style.zIndex=Xe(x(_),t)));m===Ce(f)&&(!$||!v.cgFading)?u.add(_):$&&m===Ce($)?(v.classList.add("fading"),v.cgFading=!0):Qe(h,m,v)}else Qe(h,m,v);else if(kn(v)){const k=v.className;a.get(_)===k?c.add(_):Qe(p,k,v)}v=v.nextSibling}for(const[k,H]of a)if(!c.has(k)){G=p.get(H),q=G&&G.pop();const L=n(x(k),t);if(q)q.cgKey=k,J(q,L);else{const M=ne("square",H);M.cgKey=k,J(M,L),o.insertBefore(M,o.firstChild)}}for(const[k,H]of r)if(P=l.get(k),!u.has(k))if(O=h.get(Ce(H)),y=O&&O.pop(),y){y.cgKey=k,y.cgFading&&(y.classList.remove("fading"),y.cgFading=!1);const L=x(k);e.addPieceZIndex&&(y.style.zIndex=Xe(L,t)),P&&(y.cgAnimating=!0,y.classList.add("anim"),L[0]+=P[2],L[1]+=P[3]),J(y,n(L,t))}else{const L=Ce(H),M=ne("piece",L),V=x(k);M.cgPiece=L,M.cgKey=k,P&&(M.cgAnimating=!0,V[0]+=P[2],V[1]+=P[3]),J(M,n(V,t)),e.addPieceZIndex&&(M.style.zIndex=Xe(V,t)),o.appendChild(M)}for(const k of h.values())Rt(e,k);for(const k of p.values())Rt(e,k)}function Pr(e){const t=z(e),n=Me(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(yn(o)&&!o.cgAnimating||kn(o))&&J(o,n(x(o.cgKey),t)),o=o.nextSibling}function Ht(e){var t,n;const o=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,i=o.height/o.width,l=Math.floor(o.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=l*i;r.style.width=l+"px",r.style.height=s+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",l+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",s+"px")}const yn=e=>e.tagName==="PIECE",kn=e=>e.tagName==="SQUARE";function Rt(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function Xe(e,t){const o=e[1];return`${t?10-o:3+o}`}const Ce=e=>`${e.color} ${e.role}`;function Mr(e){var t,n,o;const r=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)ee(r,s,"last-move");if(e.check&&e.highlight.check&&ee(r,e.check,"check"),e.selected&&(ee(r,e.selected,"selected"),e.movable.showDests)){const s=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(s)for(const a of s)ee(r,a,"move-dest"+(e.pieces.has(a)?" oc":""));const d=(o=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&o!==void 0?o:e.premovable.dests;if(d)for(const a of d)ee(r,a,"premove-dest"+(e.pieces.has(a)?" oc":""))}const i=e.premovable.current;if(i)for(const s of i)ee(r,s,"current-premove");else e.predroppable.current&&ee(r,e.predroppable.current.key,"current-premove");const l=e.exploding;if(l)for(const s of l.keys)ee(r,s,"exploding"+l.stage);return e.highlight.custom&&e.highlight.custom.forEach((s,d)=>{ee(r,d,s)}),r}function ee(e,t,n){const o=e.get(t);o?e.set(t,`${o} ${n}`):e.set(t,n)}function Qe(e,t,n){const o=e.get(t);o?o.push(n):e.set(t,[n])}function xr(e,t,n){const o=new Map,r=[];for(const s of e)o.set(s.hash,!1);let i=t.firstElementChild,l;for(;i;)l=i.getAttribute("cgHash"),o.has(l)?o.set(l,!0):r.push(i),i=i.nextElementSibling;for(const s of r)t.removeChild(s);for(const s of e)o.get(s.hash)||t.appendChild(n(s))}function Ar(e,t){const o=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:Tr(r),current:!1}));xr(o,t,r=>Dr(e,r,e.dom.bounds()))}function qr(e){var t;const n=z(e),o=Me(e.dom.bounds());let r=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;r;)Vt(r,o(x(r.cgKey),n),r.cgScale),r=r.nextSibling}function Dr(e,{shape:t,hash:n},o){var r,i,l;const s=t.orig,d=(r=t.piece)===null||r===void 0?void 0:r.role,a=(i=t.piece)===null||i===void 0?void 0:i.color,u=(l=t.piece)===null||l===void 0?void 0:l.scale,c=ne("piece",`${d} ${a}`);return c.setAttribute("cgHash",n),c.cgKey=s,c.cgScale=u,Vt(c,Me(o)(x(s),z(e)),u),c}const Tr=e=>{var t,n,o;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(o=e.piece)===null||o===void 0?void 0:o.scale].join(",")};function Er(e,t){const n=or();un(n,t||{});function o(){const r="dom"in n?n.dom.unbind:void 0,i=wr(e,n),l=_o(()=>i.board.getBoundingClientRect()),s=u=>{$r(a),i.autoPieces&&Ar(a,i.autoPieces),!u&&i.svg&&ir(a,i.svg,i.customSvg)},d=()=>{Ht(a),Pr(a),i.autoPieces&&qr(a)},a=n;return a.dom={elements:i,bounds:l,redraw:Nr(s),redrawNow:s,unbind:r},a.drawable.prevSvgHash="",Ht(a),s(!1),kr(a,d),r||(a.dom.unbind=Cr(a,d)),a.events.insert&&a.events.insert(i),a}return nr(o(),o)}function Nr(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function Lr(e){let t=0;return n=>{t+=n.deltaY*(n.deltaMode?40:1),Math.abs(t)>=4?(e(n,!0),t=0):e(n,!1)}}var Or=A('<div class="is2d chessboard"> ');function Br(e){let t,n,o=C(()=>{try{return Kt(e.fen)}catch{return Yn.default()}}),r=C(()=>go(o())),i=C(()=>o().isCheck());return Zn(()=>{let l=e.color,s=o().isCheck(),d={fen:e.fen,check:s,premovable:{enabled:!1},movable:{color:l,free:!1,dests:r(),events:{after:e.play_orig_key}}};n=Er(t,d)}),te(()=>{let l;if(e.last_move){let[s]=e.last_move;l=[s.slice(0,2),s.slice(2,4)]}n.set({lastMove:l,fen:e.fen,turnColor:e.color,orientation:e.orientation??"white",check:i(),movable:{color:e.movable?e.color:void 0,dests:r()}})}),te(()=>{n.setAutoShapes(e.shapes??[])}),(()=>{var l=Or();return zt(s=>t=s,l),l})()}const Hr=e=>({handleEvent:Rr(e),passive:!1}),Rr=e=>Lr(t=>{const n=t.target;n.tagName!=="PIECE"&&n.tagName!=="SQUARE"&&n.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});async function Wr(e){const t=await Kr(e);function n(r){return t.transaction(e.store,r).objectStore(e.store)}function o(r){return new Promise((i,l)=>{const s=r();s.onsuccess=d=>i(d.target.result),s.onerror=d=>l(d.target.result)})}return{list:()=>o(()=>n("readonly").getAllKeys()),get:r=>o(()=>n("readonly").get(r)),getMany:r=>o(()=>n("readonly").getAll(r)),put:(r,i)=>o(()=>n("readwrite").put(i,r)),count:r=>o(()=>n("readonly").count(r)),remove:r=>o(()=>n("readwrite").delete(r)),clear:()=>o(()=>n("readwrite").clear()),cursor:(r,i)=>o(()=>n("readonly").openCursor(r,i)).then(l=>l??void 0),txn:r=>t.transaction(e.store,r)}}async function Kr(e){const t=e?.db||`${e.store}--db`;return new Promise((n,o)=>{const r=window.indexedDB.open(t,e?.version??1);r.onsuccess=i=>n(i.target.result),r.onerror=i=>o(i.target.error??"IndexedDB Unavailable"),r.onupgradeneeded=i=>{const l=i.target.result,s=i.target.transaction,d=l.objectStoreNames.contains(e.store)?s.objectStore(e.store):l.createObjectStore(e.store);e.upgrade?.(i,d)}})}async function zr(e){let t;await Ir({on_received:i,on_status(f){f&&(f.download&&e.on_downloaded_nb(f.download),f.error&&e.on_engine_failed(f.error))},on_connected(f){t=f}}),n("uci");function n(f){t?.(f)}function o(f){d=f,_()}function r(){return!!s&&!s.stop_requested&&!s.swap_requested}function i(f){const m=f.trim().split(/\s+/g);if(m[0]==="uciok")h("UCI_Chess960","true"),n("ucinewgame"),n("isready");else if(m[0]==="readyok")u();else if(!(m[0]==="id"&&m[1]==="name"))if(m[0]==="bestmove"){s&&a&&s.emit(a),s=void 0,u();return}else if(s&&!s.swap_requested&&!s.stop_requested&&m[0]==="info"){let P=0,$,O=1,y,G,q=!1,k,H=[];for(let D=1;D<m.length;D++)switch(m[D]){case"depth":P=parseInt(m[++D]);break;case"nodes":$=parseInt(m[++D]);break;case"multipv":O=parseInt(m[++D]);break;case"time":y=parseInt(m[++D]);break;case"score":q=m[++D]==="mate",k=parseInt(m[++D]),(m[D+1]==="lowerbound"||m[D+1]==="upperbound")&&(G=m[++D]);break;case"pv":H=m.slice(++D),D=m.length;break}if(q&&!k||(l<O&&(l=O),!qe($)||!qe(y)||!qe(q)||!qe(k)))return;const M=s.ply%2===1?-k:k;if(G&&O===1)return;const V={moves:H,cp:q?void 0:M,mate:q?M:void 0,depth:P};O===1?a={fen:s.current_fen,depth:P,nodes:$,millis:y,cp:q?void 0:M,mate:q?M:void 0,pvs:[V]}:a&&(a.pvs.push(V),a.depth=Math.min(a.depth,P)),O===l&&a&&(s.on_pvs(a),P>=40&&p())}else f&&!["Stockfish","id","option","info"].includes(m[0])&&console.warn(`SF: ${f}`)}let l=0,s,d,a;function u(){if(!s&&(s=d,d=void 0,s)){a=void 0,l=1,h("Threads",s.threads),h("Hash",s.hash_size||16),h("MultiPV",Math.max(1,s.multi_pv)),v&&v!==s.game_id&&n("ucinewgame"),v=s.game_id,n(["position fen",s.initial_fen,"moves",s.moves].join(" "));const[f,m]=Object.entries(s.search)[0];n(`go ${f} ${m}`)}}let c=new Map([["Threads","1"],["Hash","16"],["MultiPV","1"],["UCI_Variant","chess"]]);function h(f,m){m=m.toString(),c.get(f)!==m&&(n(`setoption name ${f} value ${m}`),c.set(f,m))}function p(){s&&!s.stop_requested&&(s.stop_requested=!0,n("stop"))}function _(){s&&!s.swap_requested&&(s.swap_requested=!0,n("stop")),n("isready")}let v;return{start(f){o(f)},stop(){o()},destroy(){n("quit")},get state(){return r()?"computing":"idle"}}}async function Ir(e){const t=c=>{e.on_status(c)},n=c=>{e.on_received(c)},o=c=>{e.on_connected(c)};let r=await Xn(()=>import("./sf171-79-CuIQKt_o.js"),[]),i=await new Promise((c,h)=>{r.default({wasmMemory:jr(2560),onError:p=>h(new Error(p)),locateFile:p=>`stockfish/${p}`}).then(c).catch(h)}),l=await Wr({store:".banditchess.nnue"}).catch(()=>{}),s=[];for(let c=0;;c++){let h=i.getRecommendedNnue(c);if(!h||s.includes(h))break;s.push(h)}(await a(s)).forEach((c,h)=>i.setNnueBuffer(c,h)),i.onError=u(),i.listen=c=>n(c),o(c=>i.uci(c));async function a(c){return Promise.all(c.map(async h=>{let p=await l?.get(h).catch(()=>{});if(p&&p.byteLength>128*1024)return p;const _=new XMLHttpRequest;_.open("get",`stockfish/nnue/${h}`,!0),_.responseType="arraybuffer",_.onprogress=f=>t({download:{bytes:f.loaded,total:f.total}});const v=await new Promise((f,m)=>{_.onerror=()=>m(new Error(`fetch '${h}' failed: ${_.status}`)),_.onload=()=>{_.status/100===2?f(new Uint8Array(_.response)):m(new Error(`fetch '${h}' failed: ${_.status}`))},_.send()});return t(),l?.put(h,v).catch(()=>console.warn("IDB store failed")),v}))}function u(){return c=>{if(c.startsWith("BAD_NNUE")&&l){const h=Math.max(0,Number(c.slice(9))),p=i.getRecommendedNnue(h);setTimeout(()=>{console.warn(`Corrupt NNUE file, removing ${p} from IDB`),l.remove(p)},2e3)}else t({error:c})}}}const jr=(e,t=32767)=>{let n=4;for(;;)try{return new WebAssembly.Memory({shared:!0,initial:e,maximum:t})}catch(o){if(t<=e||!(o instanceof RangeError))throw o;t=Math.max(e,Math.ceil(t-t/n)),n=n===4?3:4}};function Fr(e){let t,n;return function(...o){const r=this,i=()=>{n=void 0,t=e.apply(r,o).finally(()=>{t=void 0,n&&n()})};t?n=i:i()}}function Gr(e,t){return Fr(function(...n){return t.apply(this,n),new Promise(o=>setTimeout(o,e))})}const Cn=e=>{let t;return()=>(t||(t=e()),t)},ht=navigator.userAgent.toLowerCase(),Vr=()=>Sn()||Ur(),Sn=Cn(()=>ht.includes("android")),Ur=Cn(()=>/iphone|ipod/.test(ht)||$n()),$n=()=>navigator?.maxTouchPoints>2&&/ipad|macintosh/.test(ht),Yr=(()=>{let e=0;return()=>`${e++}`})();function Zr(){let[e,t]=Q(void 0),[n,o]=Q(void 0),r=Qn(()=>zr({on_downloaded_nb(i){t(i)},on_engine_failed(i){o(i)}}));return{get downloaded_nb(){return e()},get engine_failed(){return n()},get protocol(){return r()}}}function Xr(e,t){let n,o=10,r=7,i=0,l=Vr()?1:Math.max(1,navigator.hardwareConcurrency-2),s=Sn()||$n()?64:256,d=Yr();return e.start({threads:l,hash_size:s,game_id:d,stop_requested:!1,swap_requested:!1,path:[],search:{depth:o},multi_pv:r,ply:i,threatMode:!1,initial_fen:t,current_fen:t,moves:[],emit:function(a){n(a.pvs.map(u=>({uci:u.moves[0],cp:u.cp,mate:u.mate})))},on_pvs:Gr(200,function(a){})}),new Promise(a=>{n=a})}function Qr(e){let t=Zr(),n={},[o,r]=It({get downloaded_nb(){return t.downloaded_nb},get engine_failed(){return t.engine_failed},pvs:n}),i=!1,l=[];function s(){if(!t.protocol||i)return;let u=l.shift();u&&(i=!0,Xr(t.protocol,u).then(c=>{r("pvs",u,c),i=!1,s()}))}te(ie(()=>t.protocol,s));let a=[o,{request_multipv(u){l.push(u),s()}}];return b(Pn.Provider,{value:a,get children(){return e.children}})}const Pn=jt();function Jr(){return Ft(Pn)}const ei=(e=0)=>()=>{var t=Math.sin(e++)*1e4;return t-Math.floor(t)},Mn=ei();function xn(e=Mn){return e()<.5?-1:1}function ti(e,t,n=Mn){return Math.floor(n()*(t-e)+e)}function Se(e){return e[ti(0,e.length)]}var ni=A("<section class=sliced-text> <!> "),oi=A("<div class=aurora-text><div class=title><div class=aurora><div class=aurora__item></div><div class=aurora__item></div><div class=aurora__item></div><div class=aurora__item>"),ri=A("<div class=marquee> <span></span> ");function ii(e){return(()=>{var t=ni(),n=t.firstChild,o=n.nextSibling;return o.nextSibling,w(t,()=>e.text,o),$e(()=>Jn(t,"data-heading",e.text)),t})()}function si(e){return(()=>{var t=oi(),n=t.firstChild,o=n.firstChild;return w(n,()=>e.text,o),t})()}function rt(e){return(()=>{var t=ri(),n=t.firstChild,o=n.nextSibling;return w(o,()=>e.text),t})()}async function De(e,t){const n=await fetch(t).then(r=>r.arrayBuffer());return await e.decodeAudioData(n)}function li(){let e=new AudioContext,t={};async function n(){t.hit0=await De(e,"./audio/hit0.mp3"),t.hit3=await De(e,"./audio/hit3.mp3"),t.hit6=await De(e,"./audio/hit6.wav"),t.hit5=await De(e,"./audio/hit5.wav")}function o(r,i=!1,l=.5){let s=t[r];const d=e.createBufferSource();d.buffer=s;let a=e.createGain();return a.gain.value=l,a.connect(e.destination),d.connect(a),d.loop=i,d.start(),()=>{d.stop()}}return{load:n,play:o,buffers:t}}function ai(e){let t=li();return t.load(),b(An.Provider,{value:t,get children(){return e.children}})}const An=jt();function ci(){return Ft(An)}var di=A("<div class=modal-overlay><div class=modal><div class=game-over-popup><h2>New High Score</h2><div class=leaderboards>"),ui=A('<main class=vs><div class=background><div class=p1></div><div class=p2></div></div><div class=content><div class=info><h3>Bandit vs Stockfish</h3><span>Match #</span></div><div class=board-wrap><div class=board></div></div><div class=replay-wrap><div class=top-padding></div><div class=user-top><span class="user ai">Stockfish</span><span class=time>0:00</span></div><div class=replay><div class=scores></div></div><div class=controls></div><div class=user-bottom><span class=user>You</span><span class=time>0:00</span></div><div class=bottom-padding></div></div><div class=history>'),fi=A("<div class=downloading><span>Downloading Stockfish..</span><div class=bar>"),pi=A('<input type=text placeholder="Enter Your Handle"maxlength=8 minlength=3>'),hi=A("<div class=high-score-review><div class=buttons>"),gi=A("<small>Don't Show Again"),mi=A("<div class=feedback><p>Did you like Bandit Chess?</p><div class=buttons>"),vi=A("<div class=note><div class=marquee> <span>Personal Best Achieved.</span> "),_i=A("<div class=note2>"),bi=A("<div class=win><span class=header></span><div class=scores><span class=score>Score: </span><span class=combo>Combo: "),wi=A("<div class=result><span class=over>Game Over</span><small>"),yi=A("<div class=lose><span class=header>"),ki=A("<div class=score-delta><span class=score></span><div class=combo-streak><span class=streak>x</span><span class=combo>"),Ci=A("<div class=list-wrap><div class=list><div class=padding>"),Si=A("<div class=padding>"),$i=A("<span class=step> <!> <span class=delta> </span> ");const Pi=".banditchess.vs-stockfish-save.v0";function Ri(){return b(ai,{get children(){return b(Qr,{get children(){return b(Mi,{})}})}})}function Mi(){let[e,{request_multipv:t}]=Jr();const n=()=>e.downloaded_nb,o=()=>e.engine_failed,r=C(()=>{let g=n();if(g){let S=Math.round(g.bytes/(g.total===0?74874478:g.total)*100);return S===100?void 0:S}});console.log(o());let[i,{initialize_replay:l,add_uci_and_goto_it:s,set_cursor_path:d,goto_next_path_if_can:a,goto_prev_path_if_can:u,submit_vote:c}]=$t();const[h,p]=eo(It({color:xn()?"white":"black",nth:1,sans:[],cursor_path:"",game_result:void 0,fen_pvs:{},show_vote:!0}),{name:Pi}),_=()=>h.nth;function v(g){p("sans",h.sans.length,g.san),p("cursor_path",g.path)}const f=()=>h.color,m=()=>xt(f()),P=C(()=>i.replay.list),$=C(()=>i.replay.fen),O=C(()=>i.replay.last_move),y=C(()=>h.fen_pvs[$()]!==void 0),G=()=>h.game_result===void 0&&y();l(h.sans,h.cursor_path);const q=C(()=>i.replay.list.map(g=>{let S=h.fen_pvs[g.before_fen];if(S)return Ti(S,g.uci)})),k=C(()=>i.replay.list.length<10),H=g=>{let S=C(()=>{let E=[],N=q();for(let j=g==="white"?10:11;j<N.length;j+=2)E.push(N[j]);return E}),R=C(()=>S().reduce((E,N)=>E+(N??0),0)),I=C(()=>{let E=[],N=S(),j=1;for(let W=0;W<N.length;W++){let X=N[W];if(X===void 0){E.push(E[E.length-1]??2);continue}X>0?(E.push(j),j++):(j=1,E.push(j))}return E}),ae=C(()=>I()[I().length-1]??0),we=C(()=>{let E=S(),N=I(),j=[];for(let W=0;W<E.length;W++){let X=E[W];X&&j.push(X*qn(N[W]))}return j.reduce((W,X)=>W+X,0)}),ye=C(ie(ae,(E,N)=>N===void 0?0:E-N)),Ge=()=>0,Ve=()=>0;return{get classic(){return R()},get streak(){return ae()},get combo(){return we()},get streak_delta(){return ye()},get classic_delta(){return Ge()},get combo_delta(){return Ve()}}},L=g=>{if(!g)return;let[S,R]=g;if(!h.fen_pvs[S]&&(p("fen_pvs",S,R),S===$()&&ho(S)===m())){let I=Di(R);v(s(I.uci)),xe()}};let M=ci();const V=(g,S)=>{g===0?M.play("hit0",!1,S):g<3?M.play("hit3",!1,S):g<5?M.play("hit5",!1,S):M.play("hit6",!1,S)};Pt(ie(q,(g,S)=>{if(!S||g.length!==S.length){let R=g[g.length-1],I=f()===(g.length%2===1?"white":"black");R!==void 0&&V(R,I?.5:.1)}}));const D=(g,S)=>{let R=g+S;{let I=Kt($()),ae=I.turn;I.board.get(so(g)).role==="pawn"&&(S[1]==="8"&&ae==="white"||S[1]==="1"&&ae==="black")&&(R+="q")}v(s(R)),xe()},xe=()=>{if(oo($())){let g=["game-ended",ro($())];p("game_result",g),Fe(je()!==void 0)}else io($())?(p("game_result",["40-reached",void 0]),Fe(je()!==void 0)):t($())},He=()=>{fo(()=>{p("color",xt(h.color)),p("game_result",void 0),p("nth",g=>g+1),p("sans",At([])),p("cursor_path",""),p("fen_pvs",At({})),l([],""),xe()})},Dn=()=>{He()};let gt=to();const Tn=()=>{He(),gt("/")},En=()=>{He(),gt("/top")},Nn=g=>{g>0?a():u()};Pt(ie(()=>{let g=e.pvs[$()];if(g)return[$(),g]},L));let Re=C(()=>H("white")),We=C(()=>H("black")),ve=C(()=>f()==="white"?Re():We()),mt=C(()=>m()==="white"?Re():We()),[{leaderboard:_e},{add_top_score:Ln,add_top_combo:On}]=$t();const[Ke,Bn]=Q(""),[be,vt]=Q(!1),ze=C(()=>[Ke(),ve().classic,Date.now()]),Ie=C(()=>[Ke(),ve().combo,Date.now()]),_t=C(()=>h.game_result?h.game_result[1]===f()?!0:ve().classic>mt().classic||ve().combo>mt().combo:!1),bt=C(()=>{if(!_t())return;let g=Mt(_e.top_scores,ze());if(g!==-1)return g}),wt=C(()=>{if(!_t())return;let g=Mt(_e.top_combos,Ie());if(g!==-1)return g});function yt(g,S,R){return g=g.slice(0),g.splice(S,0,R),g.pop(),g}const kt=C(()=>{let g=bt();if(g!==void 0)return be()?_e.top_scores:yt(_e.top_scores,g,ze())}),Ct=C(()=>{let g=wt();if(g!==void 0)return be()?_e.top_combos:yt(_e.top_combos,g,Ie())}),je=C(()=>kt()||Ct()),[Hn,Fe]=Q(!1),Rn=g=>{Bn(g)},Wn=()=>{Ln(ze()),On(Ie()),vt(!0)},[Kn,zn]=Q(h.show_vote),In=()=>{Fe(!1),vt(!1)},jn=()=>{p("show_vote",!1)},Fn=g=>{c(Ke(),g),zn(!1)};return xe(),(()=>{var g=ui(),S=g.firstChild,R=S.nextSibling,I=R.firstChild,ae=I.firstChild,we=ae.nextSibling;we.firstChild;var ye=I.nextSibling,Ge=ye.firstChild,Ve=ye.nextSibling,E=Ve.firstChild,N=E.nextSibling,j=N.firstChild;j.nextSibling;var W=N.nextSibling,X=W.firstChild,Ue=W.nextSibling,Gn=Ue.nextSibling;return w(we,_,null),no(ye,"wheel",Hr(Nn)),w(Ge,b(Br,{get orientation(){return f()},get movable(){return G()},get color(){return f()},get fen(){return $()},get last_move(){return O()},play_orig_key:D})),w(N,b(U,{get when(){return r()},children:F=>(()=>{var ce=fi(),oe=ce.firstChild,Ae=oe.nextSibling;return $e(de=>(de=`${F()}%`)!=null?Ae.style.setProperty("width",de):Ae.style.removeProperty("width")),ce})()}),null),w(W,b(Ei,{onSetCursorPath:d,get cursor_path(){return i.replay.cursor_path},get steps(){return P()},get deltas(){return q()},get children(){return b(U,{get when(){return h.game_result},children:F=>b(qi,{get result(){return F()[0]},get top(){return je()!==void 0},get win(){return F()[1]===f()},get score(){return ve().classic},get combo(){return ve().combo}})})}}),X),w(X,b(Wt,{get small(){return f()==="black"},flip:!0,get skip(){return k()},get scores(){return Re()}}),null),w(X,b(Wt,{get small(){return f()==="white"},flip:!1,get skip(){return k()},get scores(){return We()}}),null),w(Ue,b(pe,{meet:!0,onClick:Dn,children:"Restart"}),null),w(Ue,b(pe,{meet:!0,onClick:Tn,children:"Go Home"}),null),w(g,b(U,{get when(){return Hn()},get children(){var F=di(),ce=F.firstChild,oe=ce.firstChild,Ae=oe.firstChild,de=Ae.nextSibling;return w(oe,b(rt,{text:"Personal Best Achieved"}),de),w(oe,b(U,{get when(){return be()},get fallback(){return(()=>{var ue=pi();return ue.addEventListener("change",Wn),ue.$$input=Vn=>Rn(Vn.target.value),ue})()},get children(){return b(U,{get when(){return Kn()},get fallback(){return b(xi,{onBackToGame:In,onGoHighscores:En})},get children(){return b(Ai,{onSkip:jn,onClose:Fn})}})}}),de),w(de,b(U,{get when(){return kt()},children:ue=>b(qt,{title:"Top Scores",get scores(){return ue()},get highlight(){return Je(()=>!!be())()?void 0:bt()}})}),null),w(de,b(U,{get when(){return Ct()},children:ue=>b(qt,{title:"Top Combo",get scores(){return ue()},get highlight(){return Je(()=>!!be())()?void 0:wt()}})}),null),F}}),null),$e(F=>{var ce=!y(),oe=!!G();return ce!==F.e&&N.classList.toggle("turn",F.e=ce),oe!==F.t&&Gn.classList.toggle("turn",F.t=oe),F},{e:void 0,t:void 0}),g})()}function xi(e){return(()=>{var t=hi(),n=t.firstChild;return w(n,b(pe,{get onClick(){return e.onGoHighscores},meet:!0,children:"See High Scores"}),null),w(n,b(pe,{get onClick(){return e.onBackToGame},draw:!0,children:"Back to Game"}),null),t})()}function Ai(e){const t=n=>{n==="skip"&&e.onSkip(),e.onClose(n)};return(()=>{var n=mi(),o=n.firstChild,r=o.nextSibling;return w(r,b(pe,{onClick:()=>t("yes"),draw:!0,children:"Yes"}),null),w(r,b(pe,{onClick:()=>t("no"),draw:!0,meet:!0,children:"No"}),null),w(r,b(pe,{onClick:()=>t("skip"),gray:!0,get children(){return gi()}}),null),n})()}function qi(e){return(()=>{var t=wi(),n=t.firstChild,o=n.nextSibling;return w(o,b(U,{get when(){return e.result==="40-reached"},children:"Move 40 reached."}),null),w(o,b(U,{get when(){return e.result==="game-ended"},children:"There has been a checkmate."}),null),w(t,b(U,{get when(){return e.win},get fallback(){return(()=>{var r=yi(),i=r.firstChild;return w(i,b(ii,{text:"You lost"})),r})()},get children(){var r=bi(),i=r.firstChild,l=i.nextSibling,s=l.firstChild;s.firstChild;var d=s.nextSibling;return d.firstChild,w(i,b(si,{text:"You Win!"})),w(s,()=>e.score,null),w(d,()=>e.combo,null),w(r,b(U,{get when(){return e.top},get children(){var a=vi();return a.firstChild,w(a,b(rt,{text:"Personal Best Achieved."}),null),a}}),null),w(r,b(U,{when:!1,get children(){var a=_i();return w(a,b(rt,{text:"Top Leaderboard Achieved."})),a}}),null),r}}),null),t})()}const qn=e=>e>2?4:e>1?3:2;function Wt(e){const t=e.scores,n=C(ie(()=>e.scores.classic,f=>(setTimeout(()=>s(!1),200),f))),o=C(ie(()=>e.scores.streak,(f,m)=>(setTimeout(()=>a(!1),200),[f,m??2]))),r=C(ie(()=>e.scores.combo,f=>(setTimeout(()=>c(!1),200),f))),i=C(ie(()=>e.scores.streak,(f,m)=>(setTimeout(()=>p(!1),200),[f,m??2]))),[l,s]=Q(!1),[d,a]=Q(!1),[u,c]=Q(!1),[h,p]=Q(!1);te(()=>s(n()!==void 0)),te(()=>a(_(o()))),te(()=>c(r()!==void 0)),te(()=>p(v(i())));const _=f=>f[0]>f[1],v=f=>f[0]<f[1];return(()=>{var f=ki(),m=f.firstChild,P=m.nextSibling,$=P.firstChild;$.firstChild;var O=$.nextSibling;return w(m,()=>t.classic),w($,()=>qn(t.streak),null),w(O,()=>t.combo),$e(y=>{var G=!!e.flip,q=!!e.small,k=!!e.skip,H=!!l(),L=!!e.skip,M=!!d(),V=!!h(),D=!!u();return G!==y.e&&f.classList.toggle("flip",y.e=G),q!==y.t&&f.classList.toggle("small",y.t=q),k!==y.a&&m.classList.toggle("skip",y.a=k),H!==y.o&&m.classList.toggle("bump",y.o=H),L!==y.i&&P.classList.toggle("skip",y.i=L),M!==y.n&&$.classList.toggle("bump",y.n=M),V!==y.s&&$.classList.toggle("shoot",y.s=V),D!==y.h&&O.classList.toggle("bump",y.h=D),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),f})()}function Di(e){let t=e[0].cp;if(!t)return e[0];let n=e.filter(c=>c.cp&&Math.abs(c.cp)-Math.abs(t)<10),o=e.filter(c=>c.cp&&Math.abs(c.cp)-Math.abs(t)<20),r=e.filter(c=>c.cp&&Math.abs(c.cp)-Math.abs(t)<60),i=e.filter(c=>c.cp&&Math.abs(c.cp)-Math.abs(t)>=60),l=Se(n),s=Se(o),d=Se(r),a=Se(i),u=[];return l&&(u.push(l),u.push(l),u.push(l),u.push(l)),s&&(u.push(s),u.push(s),u.push(s)),d&&(u.push(d),u.push(d)),a&&(u.push(a),xn()&&(u.push(a),u.push(a),u.push(a))),Se(u)}function Ti(e,t){let n=e.findIndex(o=>o.uci===t);return n===-1?0:e.length-n-1}function Ei(e){let t;te(()=>{let o=e.cursor_path,r=t.parentElement;if(!r)return;const i=t.querySelector(".on-path-end");if(!i){r.scrollTop=o.length>0?99999:0;return}let l=i.offsetTop-r.offsetHeight/2+i.offsetHeight;r.scrollTo({behavior:"smooth",top:l})});let n=lo(()=>e.children);return te(()=>{if(n()!==void 0){let o=t.parentElement;if(!o)return;o.scrollTop=99999;return}}),[(()=>{var o=Ci(),r=o.firstChild,i=r.firstChild;return zt(l=>{t=l},r),w(r,b(co,{get each(){return e.steps},children:(l,s)=>b(Ni,ao(e,{get is_opening(){return s()<10},get delta(){return e.deltas[s()]},step:l}))}),i),w(r,n,null),o})(),Si()]}function Ni(e){const t=C(()=>e.delta),n=e.step,o=(s,d)=>d===void 0?"...":s?d:d===0?"0":`+${d}`,r=(s,d)=>d===void 0?"":i()?s?"opening":d>=5?"five":d>2?"four":d>0?"one":"zero":"",[i,l]=Q(!1);return setTimeout(()=>l(!0),100),(()=>{var s=$i(),d=s.firstChild,a=d.nextSibling,u=a.nextSibling,c=u.nextSibling,h=c.firstChild;return s.$$click=()=>e.onSetCursorPath(n.path),w(s,(()=>{var p=Je(()=>n.ply%2===1);return()=>p()?Li(n.ply):""})(),d),w(s,()=>n.san,a),w(c,()=>o(e.is_opening,t()),h),$e(p=>{var _=n.path===e.cursor_path,v={opening:e.is_opening,[r(e.is_opening,e.delta)]:!0};return _!==p.e&&s.classList.toggle("on-path-end",p.e=_),p.t=uo(c,v,p.t),p},{e:void 0,t:void 0}),s})()}const Li=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");po(["input","click"]);export{Pi as PERSIST_NAME_PLAY_SHOW_STATE,Ri as default,Li as ply_to_index};
